---
params:
  apt : "EDDS"
  date: !r lubridate::today()
  tfc: !r mtcars
title: "`r params$apt`"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows # columns
    #vertical_layout: scroll # fill # forces filled page (not good for multiple charts)
---

```{r setup, include=FALSE}
library(flexdashboard)
library(ggplot2)
library(plotly)
```

# Home {data-icon="fa-home"}

Overview {.sidebar}
-------------------------------------

For more information contact <a href="mailto:pru-support@eurocontrol.int?subject=Airport Dashboard">PRU Support</a>.

This report was created on `r params$date` and presents the performance at `r params$apt`.


# Traffic

This needs to be further developed

Row
-----------------------------------------------------------------------

### Daily Arrival Count {data-width=300}

```{r}
p <- params$tfc %>%
  plot_ly(x = ~FLT_DATE, y = ~FLT_ARR_1, type = 'scatter', mode = 'lines'
          , line = list(width = 1, shape = "hvh", color = 'lightgreen')
          ) %>%
  layout(#title = "Daily Total Arrival Count"
         #, 
         margin = list(t = 75)  # increase margin to deconflict titel and buttons
         , xaxis = list(title = ""
         , rangeselector = list(
        buttons = list(
          list(
            count = 3,
            label = "3 mo",
            step = "month",
            stepmode = "backward"),
          list(
            count = 6,
            label = "6 mo",
            step = "month",
            stepmode = "backward"),
          list(
            count = 1,
            label = "1 yr",
            step = "year",
            stepmode = "backward"),
          list(
            count = 1,
            label = "YTD",
            step = "year",
            stepmode = "todate"),
          list(step = "all"))),

      rangeslider = list(type = "date")
                        )
         , yaxis = list(title = "Number of Arrivals")
         )

p
```

### Annual Variation of Movements {data-width=300}

```{r}
tmp <- params$tfc %>%
  select(YEAR, DATE = FLT_DATE, FLT_DEP_1, FLT_ARR_1) %>%
  pivot_longer(cols = starts_with("FLT_"), names_to = "PHASE", values_to = "MVTS") %>%
  separate(PHASE, into = c(NA, "PHASE", NA), sep = "_")

pbox_group <- tmp %>%
  plot_ly(x = ~YEAR, y = ~MVTS, color = ~PHASE, type = "box") %>%
  layout(boxmode = "group")

pbox_group
```


### Daily Departure Count {data-width=300}

```{r}
pdeps <- params$tfc %>%
  plot_ly(x = ~FLT_DATE, y = ~FLT_DEP_1, type = 'scatter', mode = 'lines'
          , line = list(width = 1, shape = "hvh"
                        #, color = 'lightgreen'  # default is blue
                        )
          ) %>%
  layout(#title = ""
         #, 
         margin = list(t = 75)  # increase margin to deconflict titel and buttons
         , xaxis = list(title = ""
         , rangeselector = list(
        buttons = list(
          list(
            count = 3,
            label = "3 mo",
            step = "month",
            stepmode = "backward"),
          list(
            count = 6,
            label = "6 mo",
            step = "month",
            stepmode = "backward"),
          list(
            count = 1,
            label = "1 yr",
            step = "year",
            stepmode = "backward"),
          list(
            count = 1,
            label = "YTD",
            step = "year",
            stepmode = "todate"),
          list(step = "all"))),

      rangeslider = list(type = "date")
                        )
         , yaxis = list(title = "Number of Departures")
         )

pdeps
```

Row
-----------------------------------------------------------------------

### Panel A {data-width=300}

2nd row for more fun stuff


# More Stuff

This needs to be further developed

Row
-----------------------------------------------------------------------

### Panel A {data-width=300}

### Panel B {data-width=300}

### Panel C {data-width=300}


Row
-----------------------------------------------------------------------

### Panel A {data-width=300}

### Panel B {data-width=300}

### Panel C {data-width=300}




# Info & Disclaimer {data-icon="fa-question-circle"}

Â© European Organisation for the Safety of Air Navigation (EUROCONTROL) 

These webpages and data is published by the EUROCONTROL Performance Review Unit in the interest of the exchange of information. It may be copied in whole or in part providing that this copyright notice and disclaimer are included. 
The information may not be modified without prior written permission from the EUROCONTROL Performance Review Unit.

The information does not necessarily reflect the official views or policy of EUROCONTROL, which makes no warranty, either implied or express, for the information contained in this document, including its accuracy, completeness or usefulness.

Throughout the preparation of the information presented on these webpages or the underlying data all due care have been given. If however, you find an error or inaccuracy, please let us know.

